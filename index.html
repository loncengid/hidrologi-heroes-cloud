<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hidrologi Heroes â€“ Lacak si Tirta</title>

<style>
body{
  margin:0;font-family:Arial,system-ui;
  background:#eaf3ff;color:#123;
}
header{
  background:#4da3ff;color:#fff;
  padding:16px;text-align:center;
}
h1{margin:0;font-size:22px}
main{padding:16px}
.card{
  background:#fff;border-radius:18px;
  padding:18px;margin-bottom:16px;
  box-shadow:0 6px 14px rgba(0,0,0,.1);
}
button{
  width:100%;padding:14px;margin-top:10px;
  border:none;border-radius:14px;
  font-size:18px;font-weight:bold;
  background:#4da3ff;color:#fff;
}
button.secondary{background:#8bc34a}
button.warn{background:#ff9800}
input{
  width:100%;padding:12px;
  margin-top:6px;margin-bottom:10px;
  border-radius:12px;border:1px solid #ccc;
  font-size:16px;
}
.choice{margin:6px 0}
.footer{
  position:fixed;bottom:0;left:0;right:0;
  background:#fff;padding:10px;
  display:flex;gap:10px;
}
.footer button{font-size:14px;padding:10px}
.hidden{display:none}
.badge{
  display:inline-block;padding:6px 12px;
  background:#e0f2ff;border-radius:999px;
  font-size:14px;margin-bottom:10px;
}
</style>
</head>

<body>

<header>
  <h1>Hidrologi Heroes</h1>
  <div>Lacak si Tirta, Air Ajaib ğŸ’§</div>
</header>

<main id="app"></main>

<div class="footer">
  <button onclick="goHome()">ğŸ  Home</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

/* ==== Firebase ==== */
const firebaseConfig = {
  apiKey: "AIzaSyCbKNlViQO-BRj818y-sNd7LjvMkf6Q0Wg",
  databaseURL: "https://hidrologi-heroes-default-rtdb.asia-southeast1.firebasedatabase.app"
};
const appFB = initializeApp(firebaseConfig);
const db = getDatabase(appFB);

/* ==== Online Counter ==== */
const cid="c_"+Math.random().toString(36).slice(2);
update(ref(db,"online/"+cid),{ts:Date.now()});
setInterval(()=>update(ref(db,"online/"+cid),{ts:Date.now()}),5000);

/* ==== Session Siswa ==== */
function getSession(){
  return JSON.parse(localStorage.getItem("hh_student")||"null");
}
function saveSession(s){
  localStorage.setItem("hh_student",JSON.stringify(s));
}

/* ==== State ==== */
let page="home";
let quizIndex=0;
let score=0;

/* ==== Soal ==== */
const quiz=[
 {q:"Evaporasi adalah...",o:["Hujan","Penguapan","Awan"],a:1},
 {q:"Hujan disebut...",o:["Evaporasi","Presipitasi","Kondensasi"],a:1},
 {q:"Awan terbentuk karena...",o:["Kondensasi","Hujan","Aliran"],a:0},
 {q:"PLTMH adalah...",o:["Tenaga uap","Tenaga air","Tenaga angin"],a:1},
 {q:"Air mengalir ke sungai disebut...",o:["Aliran","Uap","Awan"],a:0},
 {q:"Banjir terjadi karena...",o:["Air berlebih","Air habis","Angin"],a:0},
 {q:"Siklus air dimulai dari...",o:["Penguapan","Hujan","Awan"],a:0},
 {q:"Energi air digunakan untuk...",o:["Mainan","Listrik","Makanan"],a:1},
 {q:"Uap air naik karena...",o:["Panas","Hujan","Es"],a:0},
 {q:"Air penting bagi...",o:["Manusia","Hewan","Semua"],a:2},
];

/* ==== Render ==== */
function render(){
  const a=document.getElementById("app");
  a.innerHTML="";

  /* HOME */
  if(page==="home"){
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<div class="badge">ğŸ‘¥ Online: <span id="on">0</span></div>
    <button onclick="page='belajar';render()">ğŸ’ BELAJAR</button>
    <button onclick="page='data';render()">ğŸ“ KUIS</button>
    <button onclick="page='diorama';render()">ğŸ¥ DIORAMA</button>
    <button onclick="page='guru';render()">ğŸ‘©â€ğŸ« GURU</button>`;
    a.appendChild(c);

    onValue(ref(db,"online"),s=>{
      let n=0,now=Date.now();
      s.forEach(x=>{if(now-x.val().ts<15000)n++;});
      document.getElementById("on").innerText=n;
    });
  }

  /* BELAJAR */
  if(page==="belajar"){
    const materi=[
      "Evaporasi: air menguap karena panas matahari.",
      "Kondensasi: uap air menjadi awan.",
      "Presipitasi: hujan turun ke bumi."
    ];
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h3>ğŸ“˜ Belajar Siklus Air</h3><p>${materi[quizIndex]||"Selesai ğŸ‰"}</p>
    <button onclick="quizIndex++;render()">LANJUT â¡</button>`;
    a.appendChild(c);
  }

  /* DATA SISWA */
  if(page==="data"){
    const s=getSession()||{};
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <h3>ğŸ§’ Data Siswa</h3>
      <input id="nm" placeholder="Nama" value="${s.name||""}">
      <input id="kl" placeholder="Kelas" value="${s.kelas||""}">
      <button onclick="saveData()">Mulai Kuis</button>`;
    a.appendChild(c);
    window.saveData=()=>{
      saveSession({name:nm.value,kelas:kl.value,score:null});
      quizIndex=0;score=0;page="quiz";render();
    };
  }

  /* KUIS */
  if(page==="quiz"){
    const q=quiz[quizIndex];
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h3>${quizIndex+1}. ${q.q}</h3>`;
    q.o.forEach((o,i)=>{
      c.innerHTML+=`<div class="choice">
      <button class="secondary" onclick="answer(${i})">${o}</button></div>`;
    });
    a.appendChild(c);
    window.answer=(i)=>{
      if(i===q.a) score++;
      quizIndex++;
      if(quizIndex>=quiz.length){
        const s=getSession();s.score=score+"/"+quiz.length;saveSession(s);
        page="hasil";
      }
      render();
    };
  }

  /* HASIL */
  if(page==="hasil"){
    const s=getSession();
    a.innerHTML=`<div class="card">
      <h3>ğŸ‰ Hasil Kuis</h3>
      <p>${s.name} (${s.kelas})</p>
      <h2>${s.score}</h2>
      <button onclick="page='home';render()">Selesai</button>
    </div>`;
  }

  /* DIORAMA */
  if(page==="diorama"){
    a.innerHTML=`<div class="card">
      <h3>ğŸ¥ Diorama</h3>
      <button onclick="log('Evaporasi')">Evaporasi</button>
      <button onclick="log('Kondensasi')">Kondensasi</button>
      <button onclick="log('Presipitasi')">Presipitasi</button>
    </div>`;
  }

  /* GURU */
  if(page==="guru"){
    const s=getSession();
    a.innerHTML=`<div class="card">
      <h3>ğŸ‘©â€ğŸ« Monitoring Guru</h3>
      <p>Online saat ini ditampilkan di menu utama.</p>
      <p>Skor terakhir: <b>${s?.score||"-"}</b></p>
      <p>Versi: NISEEF v12</p>
    </div>`;
  }
}

function goHome(){page="home";render();}
window.log=(m)=>console.log("[DIORAMA]",m);
render();
</script>

</body>
</html>
