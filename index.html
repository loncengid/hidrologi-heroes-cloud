<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Hidrologi Heroes : Lacak si Tirta, Air Ajaib</title>

<style>
:root{
  --bg:#0b1220;--card:#111b33;--line:#22345f;
  --btn:#16244a;--btnOn:#2c5cff;--txt:#e8eefc;
  --accent:#6cf2c2;
}
body{margin:0;font-family:system-ui,Segoe UI,Arial;background:var(--bg);color:var(--txt)}
header{display:flex;align-items:center;gap:12px;padding:12px 16px;background:#0e1833;border-bottom:1px solid var(--line)}
header img{width:44px;height:44px}
h1{font-size:18px;margin:0}
.small{font-size:13px;opacity:.9}

#breadcrumb{padding:8px 16px;font-size:13px;opacity:.85}
#content{padding:16px}

.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
.card{
  background:var(--card);border:1px solid var(--line);
  border-radius:16px;padding:16px;text-align:center;
  cursor:pointer;transition:.2s;
}
.card:hover{transform:translateY(-2px);border-color:var(--btnOn)}
.card .icon{font-size:32px;margin-bottom:8px}

.navbar{
  position:fixed;left:0;right:0;bottom:0;
  display:flex;gap:10px;padding:12px;background:#0e1833;border-top:1px solid var(--line)
}
.navbar button{
  flex:1;padding:12px;border-radius:14px;
  border:1px solid var(--line);background:var(--btn);color:var(--txt);
  font-weight:700
}
.navbar button:disabled{opacity:.4}

input,select{
  width:100%;padding:10px;border-radius:12px;
  border:1px solid var(--line);background:#0e1833;color:var(--txt)
}
.quiz-card{
  background:#0e1833;border:1px solid var(--line);
  border-radius:14px;padding:14px;margin-bottom:12px
}
.choice{margin:6px 0}

.badge{display:inline-block;padding:4px 8px;border-radius:999px;
  background:#0e1833;border:1px solid var(--line);font-size:12px}

.log{background:#000;color:#6cf2c2;padding:10px;border-radius:10px;font-family:monospace}
</style>
</head>

<body>

<header>
  <img src="https://i.imgur.com/7QZQZ6R.png" alt="Tirta"/>
  <div>
    <h1>Hidrologi Heroes</h1>
    <div class="small">Lacak si Tirta, Air Ajaib</div>
  </div>
</header>

<div id="breadcrumb"></div>
<div id="content"></div>

<div class="navbar">
  <button id="btnBack">‚¨Ö Back</button>
  <button id="btnHome">üè† Home</button>
  <button id="btnNext">‚û° Next</button>
</div>

<audio id="sndClick" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getDatabase, ref, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyCbKNlViQO-BRj818y-sNd7LjvMkf6Q0Wg",
  authDomain: "hidrologi-heroes.firebaseapp.com",
  databaseURL: "https://hidrologi-heroes-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "hidrologi-heroes",
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= MENU TREE ================= */
const tree = {
  home:{title:"Menu Utama",type:"menu",children:["proyek","siswa","guru","diorama"]},

  proyek:{title:"Penjelasan Proyek",type:"menu",parent:"home",children:["materi"]},
  materi:{title:"Materi Dasar",type:"menu",parent:"proyek",children:["evap","kond","pres"]},
  evap:{title:"Evaporasi",type:"page",parent:"materi",content:"Evaporasi adalah proses perubahan air menjadi uap air karena panas matahari."},
  kond:{title:"Kondensasi",type:"page",parent:"materi",content:"Kondensasi adalah proses perubahan uap air menjadi titik-titik air di awan."},
  pres:{title:"Presipitasi",type:"page",parent:"materi",content:"Presipitasi adalah peristiwa turunnya hujan ke permukaan bumi."},

  siswa:{title:"Siswa",type:"menu",parent:"home",children:["data","quiz","hasil"]},
  data:{title:"Isi Data Siswa",type:"page",parent:"siswa"},
  quiz:{title:"Kuis",type:"page",parent:"siswa"},
  hasil:{title:"Hasil Kuis",type:"page",parent:"siswa"},

  guru:{title:"Guru",type:"menu",parent:"home",children:["monitor"]},
  monitor:{title:"Monitoring Guru",type:"page",parent:"guru"},

  diorama:{title:"Diorama",type:"page",parent:"home"},
};

/* ================= STATE ================= */
let current="home";
let history=[];

/* ================= SESSION SISWA ================= */
function getStudent(){
  return JSON.parse(localStorage.getItem("hh_student")||"null");
}
function setStudent(d){
  localStorage.setItem("hh_student",JSON.stringify(d));
}

/* ================= ONLINE ================= */
const cid="c_"+Math.random().toString(36).slice(2);
update(ref(db,"online/"+cid),{ts:Date.now()});
setInterval(()=>update(ref(db,"online/"+cid),{ts:Date.now()}),5000);

/* ================= RENDER ================= */
function render(){
  const n=tree[current];
  document.getElementById("breadcrumb").innerText=breadcrumb(current);

  const c=document.getElementById("content");
  c.innerHTML="";

  if(n.type==="menu"){
    if(current==="home"){
      c.innerHTML=`<div class="badge">üë• Online: <span id="onlineCount">0</span></div><br><br>`;
      onValue(ref(db,"online"),snap=>{
        const now=Date.now();
        let cnt=0;
        snap.forEach(s=>{
          if(now-s.val().ts<15000) cnt++;
        });
        document.getElementById("onlineCount").innerText=cnt;
      });
    }
    const g=document.createElement("div");
    g.className="grid";
    n.children.forEach(id=>{
      const d=document.createElement("div");
      d.className="card";
      d.innerHTML=`<div class="icon">üìò</div><b>${tree[id].title}</b>`;
      d.onclick=()=>go(id);
      g.appendChild(d);
    });
    c.appendChild(g);
  }else{
    if(current==="data"){
      const s=getStudent()||{};
      c.innerHTML=`
      <div class="quiz-card">
        <b>Nama</b><input id="nama" value="${s.name||""}">
        <b>Kelas</b><input id="kelas" value="${s.kelas||""}">
        <br><br><button onclick="saveData()">Simpan & Lanjut</button>
      </div>`;
      window.saveData=()=>{
        setStudent({name:nama.value,kelas:kelas.value,score:null});
        go("quiz");
      };
    }
    else if(current==="quiz"){
      const s=getStudent();
      if(!s){c.innerHTML="Isi data dulu.";return;}
      renderQuiz(c);
    }
    else if(current==="hasil"){
      const s=getStudent();
      c.innerHTML=s?`Score ${s.name}: <b>${s.score??"-"}</b>`:"Belum ada data.";
    }
    else if(current==="monitor"){
      c.innerHTML="<b>IP / Client Online</b><div id='list'></div>";
      onValue(ref(db,"online"),snap=>{
        let html="";
        snap.forEach(s=>{
          html+=`<div class="small">${s.key}</div>`;
        });
        document.getElementById("list").innerHTML=html;
      });
    }
    else if(current==="diorama"){
      c.innerHTML=`
      <div class="quiz-card">
        <b>Diorama (Mode Serial)</b>
        <div class="log" id="log"></div>
        <button onclick="logIt('Evaporasi ON')">Evaporasi</button>
        <button onclick="logIt('Kondensasi ON')">Kondensasi</button>
        <button onclick="logIt('Presipitasi ON')">Presipitasi</button>
      </div>`;
      window.logIt=(m)=>{
        console.log("[DIORAMA]",m);
        log.innerText+=m+"\\n";
      };
    }
    else{
      c.innerHTML=n.content;
    }
  }

  btnBack.disabled=history.length===0;
  btnNext.disabled=!nextSibling();
}

/* ================= NAV ================= */
function go(id){
  history.push(current);
  current=id;
  click();render();
}
function back(){if(history.length){current=history.pop();render();}}
function home(){history.push(current);current="home";render();}
function nextSibling(){
  const p=tree[current].parent;
  if(!p) return null;
  const s=tree[p].children||[];
  const i=s.indexOf(current);
  return s[i+1]||null;
}
function next(){
  const n=nextSibling();
  if(n) go(n);
}
function breadcrumb(id){
  const a=[];
  while(id){a.unshift(tree[id].title);id=tree[id].parent;}
  return a.join(" / ");
}
function click(){document.getElementById("sndClick").play();}

/* ================= QUIZ ================= */
const quiz=[
  {q:"Evaporasi adalah...",o:["Hujan","Penguapan","Pengendapan"],a:1},
  {q:"Hujan disebut...",o:["Kondensasi","Presipitasi","Evaporasi"],a:1},
  {q:"Energi air dimanfaatkan pada...",o:["PLTMH","PLTU","PLTS"],a:0},
  {q:"Awan terbentuk saat...",o:["Evaporasi","Kondensasi","Presipitasi"],a:1},
  {q:"Air mengalir ke sungai disebut...",o:["Evaporasi","Aliran","Kondensasi"],a:1},
  {q:"Banjir terjadi karena...",o:["Air kurang","Air berlebih","Udara panas"],a:1},
  {q:"Siklus air dimulai dari...",o:["Hujan","Penguapan","Awan"],a:1},
  {q:"PLTMH singkatan dari...",o:["Pembangkit Listrik Tenaga Mikrohidro","Tenaga Matahari","Tenaga Uap"],a:0},
  {q:"Uap air naik karena...",o:["Gravitasi","Panas","Hujan"],a:1},
  {q:"Air penting bagi...",o:["Manusia","Hewan","Semua makhluk"],a:2},
];
function renderQuiz(c){
  let html="";
  quiz.forEach((x,i)=>{
    html+=`<div class="quiz-card"><b>${i+1}. ${x.q}</b>`;
    x.o.forEach((o,j)=>{
      html+=`<div class="choice">
        <input type="radio" name="q${i}" value="${j}"> ${o}
      </div>`;
    });
    html+="</div>";
  });
  html+=`<button onclick="submitQuiz()">Kirim Jawaban</button>`;
  c.innerHTML=html;
}
window.submitQuiz=()=>{
  let score=0;
  quiz.forEach((x,i)=>{
    const v=document.querySelector(`input[name=q${i}]:checked`);
    if(v && Number(v.value)===x.a) score++;
  });
  const s=getStudent();s.score=score+"/"+quiz.length;setStudent(s);
  go("hasil");
};

/* ================= INIT ================= */
btnBack.onclick=back;
btnHome.onclick=home;
btnNext.onclick=next;
render();
</script>

</body>
</html>
